## Docker镜像

操作系统分为内核和用户空间，linux内核启动后会挂在root文件系统为用户空间提供支持，docker镜像就相当于一个root文件系统。

**Docker 镜像** 是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像 **不包含** 任何动态数据，构建好的doker是不会改变的。

+ 分层存储

  在docker镜像构建时会分层进行构建，是多层文件系统联合组成。每层构建完，该层不再发生变化。例如，删除前一层文件的操作，仅仅是在我当前层操作，标记了文件已删除，但实际文件依然存在。

![image-20240112161736656](https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/2024/image-20240112161736656.png)

可以看出是分层构建的

## Docker容器

容器的实质是进程，但与直接在宿主执行的进程不同，容器进程运行于属于自己的独立的命名空间。因此容器可以拥有自己的 `root` 文件系统、自己的网络配置、自己的进程空间，甚至自己的用户 ID 空间。

简单理解，容器用于挂载镜像，是一个独立的环境。

镜像是分层存储的，容器也不例外，在创建容易时，指定镜像为容器的基础层，在此基础上创建一个当前容器的存储层(容器存储层)

容器存储层的生存周期和容器一样，容器消亡时，容器存储层也随之消亡。因此，任何保存于容器存储层的信息都会随容器删除而丢失。

推荐使用数据卷或者绑定宿主目录，在这些位置的读写会跳过容器存储层，直接对宿主（或网络存储）发生读写，其性能和稳定性更高。

### 数据卷

`数据卷` 是一个可供一个或多个容器使用的特殊目录，它绕过 UnionFS，可以提供很多有用的特性：

- `数据卷` 可以在容器之间共享和重用
- 对 `数据卷` 的修改会立马生效
- 对 `数据卷` 的更新，不会影响镜像
- `数据卷` 默认会一直存在，即使容器被删除

> 注意：`数据卷` 的使用，类似于 Linux 下对目录或文件进行 mount，镜像中的被指定为挂载点的目录中的文件会复制到数据卷中（仅数据卷为空时会复制）。

## Docker Registry

一种镜像的集中存储和分发的服务，我们执行镜像拉取操作就是通过这个服务，从不同的仓库中拉取镜像，详细操作请看docker的使用

镜像分发服务分为公开和私有，公开服务即我们常见的docker hub等，私有服务则是我们本地搭建的docker registry。