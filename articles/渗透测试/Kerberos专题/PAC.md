## PAC介绍

PAC由微软为了访问控制而引入，用于解决用户是否有权限访问目标服务的验证

+ 在AS_REQ流程中，请求凭据是用户hash加密的内容，如果解密正确KDC会返回krbtgt hash加密的TGT，TGT中就包含了PAC，PAC中包含了用户的sid,用户所在的组

+ 在TGS_REQ流程中，用户原样返回TGT票据附带时间戳等信息，KDC使用krbtgt hash进行解密，成功则返回服务hash 加密的TGS票据(这一步不管用户有没有访问服务的权限，只要TGT正确，就返回TGS票据，这也是kerberoating能利用的原因，任何一个用户，只要hash正确，可以请求域内任何一个服务的TGS票据)

+ 服务使用自身的hash解密用户发来的TGS票据，使用其中的PAC去KDC询问用户是否有权限访问该服务，**域控解密PAC。获取用户的sid，以及所在的组，再判断用户是否有访问服务的权限，有访问权限(有些服务并没有验证PAC这一步，这也是白银票据能成功的前提，因为就算拥有用户hash，可以制作TGS，也不能制作PAC，PAC当然也验证不成功，但是有些服务不去验证PAC，这是白银票据成功的前提）**就允许用户访问。