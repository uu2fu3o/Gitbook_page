---
title: 流量分析
date: 2023-09-03T15:29:52+08:00
updated: 2023-04-28T00:39:55+08:00
categories: 
- 渗透测试
- 外网漏洞
---

### TCP与UDP详解

```
TCP的三次握手
TCP连接
客户					服务器
	--->SYN=1,seq=x
	<---SYN=1,ACK=1,seq=y,ack=x+1
	--->ACK=1,seq=x+1,ack=y+1
TCP4次握手
TCP断开
	--->FIN=1,seq=u,ACK=1
	<---ACK=1,seq=v,ack=u+1
	<---FIN=1,ACK=1,seq=w,ack=u+1
	--->ACK=1,seq=u+1,ack=w+1
```

```
UDP无连接协议
并不关心传输可靠性，需要应用自身采取步骤
```

理解seq与ack....

```
发送方
设一号数据帧seq=x,len=199(不包括tcp头部长度)
则二号seq=x+199
回复方
三号:ACK=x+199,seq=ACK(发送方)
```

根据此特点，可以从小到大排列数据帧，或者判断哪些包丢失，丢失的长度为多少；

滑动窗口机制

```
服务端与客户端之间通过ACK窗口判断可用空间大小
当服务端容量不足时，利用ACK数据包来进行通信，并告知后续开放的容量
```

TCP重传技术

```
网络出现错误等导致数据包丢失，就会进行TCP重传，重传次数可自行修改
Data区段完全一致
```

### ICMP协议

基本概念：互联网控制消息协议(ICMP) 是**网络设备用来诊断网络通信问题的网络层协议**。 ICMP 主要用于确定数据是否及时到达其预期的目的地。 通常，ICMP 协议用于网络设备，例如路由器。 ICMP 对于错误报告和测试至关重要，但它也可用于分布式拒绝服务(DDoS) 攻击。

例如ping就是发送echo icmp数据包，判断连接

```
数据包
type：类型或分类
code: 子类型
TTL判断路由数目
```

### DHCP协议

基础概念：

是**一种使网络管理员能够集中管理和自动分配IP网络地址的通信协议**。 在IP网络中，每个连接Internet的设备都需要分配唯一的IP地址。 DHCP使网络管理员能从中心结点监控和分配IP地址。 当某台计算机移到网络中的其它位置时，能自动收到新的IP地址。

```
客户端 			DHCP服务器
      --->Discover
      <---offer
      --->request
      <---ACK
```

### DNS协议

将主机名和域名解析为IP地址（默认port 53）

DNS递归查询

### HTTP与HTTPS协议

超文本传输协议（HTTP）是一个**用于传输超媒体文档（例如HTML）的应用层协议**。 它是为Web 浏览器与Web 服务器之间的通信而设计的，但也可以用于其他目的。 HTTP 遵循经典的客户端—服务端模型，客户端打开一个连接以发出请求，然后等待直到收到服务器端响应。

请求与应答的过程

```
客户端			服务器
	--->建立连接
	--->发送请求信息
	<---发送响应数据包
	--->断开连接
```

主要对http报头的数据进行分析

HTTPS基于HTTP开发，安全版本的HTTP

https并不绝对安全，在某些环境下仍然可以解密

### FTP协议

文件传输协议，分为服务器和客户端，客户端可通过FTP协议访问服务端文件

### Kerberos

https://seevae.github.io/2020/09/12/%E8%AF%A6%E8%A7%A3kerberos%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B/

### Linux-NFS协议

https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F

### windows文件共享协议--cifs

右键属性配置即可，基于TCP，由三次握手开始

关注点：tree id的值；

### E-mali数据包分析

![emailport](E:\笔记软件\笔记\从零开始的web安全\emailport.png)

SMTP协议

SMTP是**一种提供可靠且有效的电子邮件传输的协议**。 SMTP是建立在FTP文件传输服务上的一种邮件服务，主要用于系统之间的邮件信息传递，并提供有关来信的通知。 SMTP独立于特定的传输子系统，且只需要可靠有序的数据流信道支持，SMTP的重要特性之一是其能跨越网络传输邮件，即“SMTP邮件中继”。

IMAP

邮件获取协议

eamil解密

解密--->确定文件类型--->更换文件类型--->判断是否经过二次加密--->与原始文件进行对比

### 子网掩码

同样是32位，用于标志IP中哪一部分为网络地址，哪一部分为主机地址，1对应部分为网络地址，剩余为0为主机地址

```
设ip
10.10.1.22
00001010 00001010 00000001 00010110
设子网掩码
255.255.0.0
11111111 11111111 00000000 00000000
则
10.10为网络地址，1.22为主地址

```

### 无线网络数据包

与有线数据包区别在于802.11的额外头部

### 利用wireshark查看客户端重定向

windows中host文件表象，通过ip和域名进行重定向

### 浅谈SYN扫描技术

TCP SYN扫描又称“半开扫描”。回顾TCP连接的三次握手，申请方首先发送的是一个SYN数据包，服务方在接到这个SYN数据包后，如果该端口处于侦听状态，则会回复一个SYN|ACK的数据包；如果该端口没有处于侦听状态，则会回复一个RST的数据包。而此时如果对方处于侦听状态，申请方还需要再向对方回复一个ACK数据包以示建立连接。此时对方就认为连接建立，并记入日志。

无论服务方回复SYN|ACK的数据包，还是回复RST的数据包，申请方其实已经能够判断对方端口是否为“开”的状态。之后的ACK数据包发送则被对方监视，如果此时不发送ACK数据包，而是发一个RST数据包，则不仅关闭了这个未完成的连接过程，并且也会因为连接未建立而不会被对方记录。这种扫描方式因为使用了SYN标志位，所以被称为TCP SYN扫描。这种扫描技术的优点在于一般不会在目标计算机上留下记录，有时即使在用netstat命令也显示不出来；但这种方法的一个缺点是必须要有管理员权限才能建立自己的SYN数据包。

nmap 就是利用SYN扫描技术探测存活端口

### 应对ARP攻击

**ARP攻击**就是通过伪造IP地址和MAC地址实现**ARP**欺骗，能够在网络中产生大量的**ARP**通信量使网络阻塞，**攻击**者只要持续不断的发出伪造的**ARP**响应包就能更改目标主机**ARP**缓存中的IP-MAC条目，造成网络中断或中间人**攻击**。

第三方通过欺骗两台正在通信的主机来获取数据；

## CTF中的流量分析

下面我们来看看CTF中的流量分析题目

### 可能会用到的Filter

```
ip.addr== 全部包含该ip的地址  
ip.src== 源ip地址
ip.dst== 目的ip地址
eth.dst ==  筛选目标mac地址
eth.addr==  筛选MAC地址
tcp.dstport == 80 筛选tcp协议的目标端口为80的流量包 
tcp.srcport == 80 筛选tcp协议的源端口为80的流量包 
udp.srcport == 80 筛选udp协议的源端口为80的流量包
//常见的协议
http  tcp dns udp 
//长度筛选,通常1000多长度帧中含有数据，可根据此特点去寻找
udp.length== 
tcp.len>=
ip.len>=
//其他使用方法例如提取数据就不再阐述了
```

### 一些题型




## 参考链接

https://blog.csdn.net/rqaz123/article/details/123105174