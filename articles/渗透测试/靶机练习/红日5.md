---
title: 红日5
date: 2023-09-03T15:29:52+08:00
updated: 2023-08-29T02:38:07+08:00
categories: 
- 渗透测试
- 靶机练习
---

## 环境搭建

```
nat: 192.168.135.0
仅主机模式: 192.168.138.0
```

win7为双网卡，需要手动启动phpstudy

## 信息收集

win7外网ip为192.168.135.150

先扫描端口

![1](E:\笔记软件\笔记\渗透测试\靶机练习\红日5\1.png)

80端口存在服务，访问发现是thinkphp框架，直接上漏扫看一下

![2](E:\笔记软件\笔记\渗透测试\靶机练习\红日5\2.png)

扫描到一个代码执行漏洞

上网搜索该漏洞，发现可利用的工具

```
python3 thinkphp_rce.py -u http://192.168.135.150 --shell
```

成功拿到shell,可访问phpinfo()页面

![3](E:\笔记软件\笔记\渗透测试\靶机练习\红日5\3.png)

修改一下注入脚本。上传写入一句话木马

![4](E:\笔记软件\笔记\渗透测试\靶机练习\红日5\4.png)

使用蚁剑成功连接到目标

![5](E:\笔记软件\笔记\渗透测试\靶机练习\红日5\5.png)

上传cs码，获取目标主机shell

![6](E:\笔记软件\笔记\渗透测试\靶机练习\红日5\6.png)

成功上线，并且是管理员权限，执行systeminfo

![7](E:\笔记软件\笔记\渗透测试\靶机练习\红日5\7.png)

安装了三个补丁程序，把systeminfo的信息拿去识别，查找可用的内核提权漏洞![8](E:\笔记软件\笔记\渗透测试\靶机练习\红日5\8.png)

这里使用ms14-058成功提权到SYSTEM

![9](E:\笔记软件\笔记\渗透测试\靶机练习\红日5\9.png)

## 内网信息收集

### 域和域成员信息

由systeminfo的信息可知，内网ip网段为192.168.138.0

判断是否存在域

```
net  config workstation
```

![10](E:\笔记软件\笔记\渗透测试\靶机练习\红日5\10.png)

win7在域SUN中，查看域中用户

```
net user /domain
```

![11](E:\笔记软件\笔记\渗透测试\靶机练习\红日5\11.png)

```
net group "Domain Controllers" /domain
```

![12](E:\笔记软件\笔记\渗透测试\靶机练习\红日5\12.png)

发现域控主机DC

### 存活主机探测拿下域控

利用win7作为跳板，扫描192.168.138.0网段，发先存活的目标主机192.168.138.138

![13](E:\笔记软件\笔记\渗透测试\靶机练习\红日5\13.png)

对方开放了445端口，并且我们已知对方域管理员用户为Administrator![14](E:\笔记软件\笔记\渗透测试\靶机练习\红日5\14.png)

WIN7的进程中有该用户的进程，尝试抓取该机器上的明文密码![15](E:\笔记软件\笔记\渗透测试\靶机练习\红日5\15.png)

成功抓取到域用户的密码，尝试使用psexec进行移动，利用smb搭建管道上线DC主机

![16](E:\笔记软件\笔记\渗透测试\靶机练习\红日5\16.png)

### 总结：

很简单的一个靶机，没有什么难点，似乎windows靶机渗透的流程都大致相同，本靶机也没有用到代理的情况，一直没有学习痕迹清理相关的内容，后面打算学习自动化的探测和痕迹清理